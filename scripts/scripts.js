!function(exports){"use strict";exports.GABJSON={concierge:{menu:{main:{actions:["news","music","fun","plan","social","learn"]},news:{title:"News is important...",actions:["sports_news","hot_news","political_news","world_news","gossip_news","inspiring_news"]},music:{title:"News is important...",actions:["news","music","fun","plan","social","learn"]},fun:{title:"News is important...",actions:["news","music","fun","plan","social","learn"]},plan:{title:"News is important...",actions:["news","music","fun","plan","social","learn"]},social:{title:"News is important...",actions:["news","music","fun","plan","social","learn"]},learn:{title:"News is important...",actions:["news","music","fun","plan","social","learn"]},browse:{title:"News is important...",actions:["news","music","fun","plan","social","learn"]},sports_news:{title:"Select an option, lay back and enjoy the mo'!",actions:["sports_news_scores","sports_news_all","sports_news_hockey","create_concierge"]}},link:{score_board:{logo:"http://placecage.com/100/42",text:"Label",href:"http://example.com"},rds:{logo:"http://placecage.com/102/40",text:"Label",href:"http://example.com"},stanley:{logo:"http://placecage.com/105/40",text:"Label",href:"http://example.com"}},action:{sports_news_scores:{title:"Only Scores",description:"All the Sports, one scoreboard, even cricket",type:"link",links:["score_board","rds","stanley"]},sports_news_all:{title:"All Sports",description:"All the things sports!",type:"link",links:["rds","score_board","stanley"]},sports_news_hockey:{title:"Hockey Hockey!",description:"Where's that puck!?!?!",type:"link",links:["stanley","rds","score_board"]},create_concierge:{title:"Hockey Hockey!",description:"Where's that puck!?!?!",type:"feature"},sports_news:{icon:"http://placecage.com/100/100",title:"Sports News-ah!",type:"menu"},hot_news:{icon:"http://placecage.com/100/100",title:"Burning Hot News!",type:"menu"},political_news:{icon:"http://placecage.com/100/100",title:"All About The Man!",type:"menu"},world_news:{icon:"http://placecage.com/100/100",title:"World Hapennings!",type:"menu"},gossip_news:{icon:"http://placecage.com/100/100",title:"Miley Cirus!",type:"menu"},inspiring_news:{icon:"http://placecage.com/100/100",title:"Legalize Marijuana!",type:"menu"},news:{icon:"http://placecage.com/100/100",title:"Catch Up On Some News",type:"menu"},music:{icon:"http://placecage.com/100/100",title:"Listen To Some Music",type:"menu"},fun:{icon:"http://placecage.com/100/100",title:"Laugh Your Ass Off",type:"menu"},plan:{icon:"http://placecage.com/100/100",title:"Plan Your Day",type:"menu"},social:{icon:"http://placecage.com/100/100",title:"See What Your Friends Are Up To",type:"menu"},learn:{icon:"http://placecage.com/100/100",title:"Learn Something Cool",type:"menu"}}},i18n:{en:{"News is important...":"News is important...","Select an option, lay back and enjoy the mo'!":"Select an option, lay back and enjoy the mo'!","Only Scores":"Only Scores","All Sports":"All Sports","Hockey Hockey!":"Hockey Hockey!","Sports News-ah!":"Sports News-ah!","Burning Hot News!":"Burning Hot News!","All About The Man!":"All About The Man!","World Hapennings!":"World Hapennings!","Miley Cirus!":"Miley Cirus!","Legalize Marijuana!":"Legalize Marijuana!","Catch Up On Some News":"Catch Up On Some News","Listen To Some Music":"Listen To Some Music","Laugh Your Ass Off":"Laugh Your Ass Off","Plan Your Day":"Plan Your Day","See What Your Friends Are Up To":"See What Your Friends Are Up To","Learn Something Cool":"Learn Something Cool",Label:"Click Here!"},fr:{"News is important...":"Nouvelles Importantes","Select an option, lay back and enjoy the mo'!":"Choisis une option.","Only Scores":"Juste Les Resultats","All Sports":"Tout les sports","Hockey Hockey!":"Hockey Hockey!","Sports News-ah!":"Nouvelles Sportives!","Burning Hot News!":"Nouvelles Chaudes!","All About The Man!":"Politische!","World Hapennings!":"Le Monde!","Miley Cirus!":"Miley Cirus!","Legalize Marijuana!":"Legalizez la Marijuana!","Catch Up On Some News":"Ratrappez les nouvelles","Listen To Some Music":"Ecoutez de la musique","Laugh Your Ass Off":"Rions encore!","Plan Your Day":"Plannifie ta journee","See What Your Friends Are Up To":"Tes amis font quoi?","Learn Something Cool":"Apprends qqc De Cool!",Label:"Clique Ici!"}}}}(window),function(){"use strict";var Concierge,location,__indexOf=[].indexOf||function(item){for(var i=0,l=this.length;l>i;i++)if(i in this&&this[i]===item)return i;return-1},__hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};location=window.history.location||window.location,Handlebars.registerHelper("render_actions",function(obj){var out;return out=obj.map(function(name){var rendered;return rendered=Concierge.render(Concierge.action[name]),rendered.get(0).outerHTML}),new Handlebars.SafeString(out.join(""))}),Handlebars.registerHelper("render_links",function(obj){var out;return out=obj.map(function(name){var rendered;return rendered=Concierge.render(Concierge.link[name]),rendered.get(0).outerHTML}),new Handlebars.SafeString(out.join(""))}),Concierge=function(){function Concierge(name){return this.name=name,this.classname=this.constructor.name.toLowerCase(),this.json=Concierge.json[this.classname][this.name],Concierge.decorate(this.json,{name:this.name,classname:this.classname,domid:""+this.classname+"_"+this.name}),this}return Concierge.decorate=function(object,properties){var key,val;for(key in properties)val=properties[key],object[key]=val;return object},Concierge.getJSON=function(lang){var stringified,translate_keys;return null==lang&&(lang=this.getLang()),translate_keys=["title","description","text"],stringified=JSON.stringify(GABJSON.concierge),i18n(GABJSON.i18n[lang]),JSON.parse(stringified,function(k,v){return __indexOf.call(translate_keys,k)>=0?i18n._(v):v})},Concierge.getLang=function(){return this.visitor.get("lang")||(navigator.userLanguage||navigator.language||navigator.browserLanguage||navigator.systemLanguage).replace(/-.+/,"")},Concierge.resetMenus=function(callback){return Concierge.container.find(".menu.active").removeClass("active"),setTimeout(callback,200)},Concierge.activateMenu=function(href){var name;return Concierge.busy?!1:(Concierge.busy=!0,name=href.replace(/#|_menu/g,""),Concierge.resetMenus(function(){return Concierge.menu[name].show(function(){var historyMethod;return Concierge.busy=!1,historyMethod="replaceState",history.state&&history.state.target&&history.state.target!==href&&(historyMethod="pushState"),history[historyMethod]({target:href},name,""+href)})}),this)},Concierge.init=function(container,callback){var vstats;return Concierge.visitor=new Concierge.Visitor,Concierge.container=$(container).empty(),Concierge.json=Concierge.getJSON(),vstats=Concierge.visitor.all(),Concierge.json.menu.main.actions.sort(function(a,b){return a=vstats["action_"+a]||0,b=vstats["action_"+b]||0,b-a}),Object.keys(Concierge.json).forEach(function(klass){return Concierge[klass]={},Object.keys(Concierge.json[klass]).reduce(function(mapping,name){return mapping[name]=Concierge.factory(klass,name),mapping[name].init(),mapping},Concierge[klass])}),Object.keys(Concierge.menu).forEach(function(name){var render;return render=Concierge.render(Concierge.menu[name]),Concierge.container.append(render)}),Concierge.container.off("click").on("click",".menu-action .inner, .menu .back",function(event){return event.preventDefault(),Concierge.activateMenu($(this).attr("href"))}),$("#menu_main").on("click",".action",function(){return Concierge.visitor.incr($(this).attr("id"))}),callback&&callback.call(Concierge),Concierge},Concierge.factory=function(klass,name){var Klass;return Klass=klass[0].toUpperCase()+klass.slice(1),new Concierge[Klass](name)},Concierge.render=function(instance){var $el,classname,render,templateSource;return classname=instance.classname,templateSource=$("#"+classname+"_template").html(),render=Handlebars.compile(templateSource),$el=$(render(instance.json)),$el.data(classname,instance),instance.$el=$el,$el},Concierge}(),Concierge.Action=function(_super){function Action(){return Action.__super__.constructor.apply(this,arguments)}return __extends(Action,_super),Action.prototype.init=function(){return Concierge.decorate(this.json,{href:""+this.name+"_"+this.json.type}),this},Action}(Concierge),Concierge.Link=function(_super){function Link(){return Link.__super__.constructor.apply(this,arguments)}return __extends(Link,_super),Link.prototype.init=function(){return Concierge.decorate(this.json,{href:""+this.name+"_link"}),this},Link}(Concierge),Concierge.Menu=function(_super){function Menu(){return Menu.__super__.constructor.apply(this,arguments)}return __extends(Menu,_super),Menu.prototype.init=function(){return this.isMain="main"===this.name,Concierge.decorate(this.json,{href:""+this.name+"_"+this.json.type}),this},Menu.prototype.show=function(callback){return this.$el.addClass("active"),setTimeout(callback,200)},Menu.prototype.hide=function(){return this.$el.removeClass("active"),setTimeout(callback,200)},Menu}(Concierge),Concierge.Visitor=function(){function Visitor(){return this.store=new window.Basil({namespace:"g-a-b-0-0-1",storages:["local","session","cookie"],expireDays:365}),this}return Visitor.prototype.incr=function(key){var v;if(v=this.store.get(key),v||(v=0),v&&isNaN(v))throw new Error("NaN");return this.store.set(key,++v),this},Visitor.prototype.put=function(key,value){return this.store.set(key,value)},Visitor.prototype.get=function(key){return this.store.get(key)},Visitor.prototype.del=function(key){return this.store.remove(key)},Visitor.prototype.all=function(){var keys,vis;return vis=this,keys=this.store.keys(),keys.reduce(function(out,key){return out[key]=vis.get(key),out},{})},Visitor}(),Concierge.LinkWidget=function(){function LinkWidget(el){var widget;return widget=this,widget.$el=$(el),widget.$el.on("click",".prev, .next",function(e){var dir;return e.preventDefault(),dir=$(this).hasClass("prev")?-1:1,widget.cycle(dir)}),widget.$el.find(".link:first").addClass("active"),this}return LinkWidget.prototype.cycle=function(dir){var $active,$links,$other,widget;return widget=this,widget.busy?!1:(widget.busy=!0,$links=widget.$el.find(".link"),$active=$links.filter(".active"),-1===dir?($other=$active.prev(".link"),0===$other.length&&($other=$links.last())):($other=$active.next(".link"),0===$other.length&&($other=$links.first())),$active.removeClass("active"),setTimeout(function(){return $other.addClass("active"),setTimeout(function(){return widget.busy=!1},200)},200),this)},LinkWidget}(),$.fn.linkWidget=function(){return $(this).each(function(){var $el,data;return $el=$(this),data=$el.data("linkwidget"),data||$el.data("linkwidget",data=new Concierge.LinkWidget($el)),$el})},$.fn.linkWidget.constructor=Concierge.LinkWidget,$.fn.linkWidget.prototype=Concierge.LinkWidget.prototype,$(function(){return Concierge.init("#content",function(){return $(document).on("click",".lang-en,.lang-fr",function(e){var clickLang,localLang;return e.preventDefault(),clickLang=$(this).hasClass("lang-en")?"en":"fr",localLang=Concierge.getLang(),clickLang!==localLang?(Concierge.visitor.set("lang",clickLang),window.location.reload(!0)):void 0}),Concierge.activateMenu("#main_menu"),$(".action .links").linkWidget(),$(window).on("popstate",function(event){var state;return state=event.originalEvent.state,state?Concierge.activateMenu(state.target):void 0})})}),window.Concierge=Concierge}.call(this);